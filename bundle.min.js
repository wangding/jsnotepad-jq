let np={config:{appContainer:".notepad-app"}};np.bShowStatusBar=localStorage.getItem("bShowStatusBar")||!1,np.bWrap=localStorage.getItem("bWrap")||!1,np.fontFamily=localStorage.getItem("fontFamily")||"Arial",np.fontStyle=localStorage.getItem("fontStyle")||"常规",np.fontSize=localStorage.getItem("fontSize")||"16",np.fileName="无标题",np.hasChanged=!1,np.saveFile=()=>{const e=document.createElement("a"),t=$editor.getContent(),l=new Blob([t],{type:"plain/text"});e.href=URL.createObjectURL(l),e.download=np.fileName+".txt",e.click(),URL.revokeObjectURL(e.href)},np.openFile=()=>{const e=document.createElement("input");e.type="file",e.accept=".txt",e.click(),e.onchange=()=>{let t=new FileReader;t.readAsText(e.files[0]);let l=e.files[0].name.split(".")[0];$("title").text(l+" - 记事本"),np.fileName=l,t.onloadend=e=>$editor.setContent(e.currentTarget.result)}},np.newFile=()=>{$editor.newFile(),$("title").text("无标题 - 记事本"),np.hasChanged=!1},np.setFontStyle=(e,t)=>{e.css({"常规":{"font-weight":"normal","font-style":"normal"},"斜体":{"font-weight":"normal","font-style":"italic"},"粗体":{"font-weight":"bold","font-style":"normal"},"粗斜体":{"font-weight":"bold","font-style":"italic"}}[t])},np.fontHandler=e=>{np.fontFamily=e.family,np.fontStyle=e.style,np.fontSize=e.size,localStorage.setItem("fontFamily",np.fontFamily),localStorage.setItem("fontStyle",np.fontStyle),localStorage.setItem("fontSize",np.fontSize),$editor.setFont(e)},$(()=>{$menubar.show(np.menuData),$editor.show({posHandler:(e,t)=>{$statusBar.setRowCol(e,t)},contentHandler:e=>{$menubar.enabled(1,6,e)}}),$editor.setFont({family:np.fontFamily,style:np.fontStyle,size:np.fontSize}),$statusBar.init(),$statusBar.display("true"===np.bShowStatusBar),$statusBar.display("false"===np.bWrap),$menubar.checked(2,0,"true"===np.bWrap),$menubar.checked(3,0,"true"===np.bShowStatusBar),$menubar.enabled(3,0,"false"===np.bWrap),$("body").click(()=>{$menubar.hideMenu(),$editor.focus()})}),np.menuData=[{title:"文件(F)",menuItems:[{title:"新建(N)",shortcut:"Ctrl+N",enabled:!0,handler:()=>{np.hasChanged?$dlgSave.show({saveHandler:()=>{np.saveFile(),np.newFile()},notSaveHandler:()=>np.newFile()}):np.newFile()}},{title:"打开(O)...",shortcut:"Ctrl+O",enabled:!0,handler:()=>{np.hasChanged?$dlgSave.show({saveHandler:()=>{np.saveFile(),np.openFile()},notSaveHandler:()=>np.openFile()}):np.openFile()}},{title:"保存(S)",shortcut:"Ctrl+S",enabled:!0,handler:()=>{np.saveFile(),np.hasChanged=!1,$("title").text(np.fileName+" - 记事本")}},{title:"另存为(A)...",shortcut:"",enabled:!0,handler:()=>{np.saveFile(),np.hasChanged=!1,$("title").text(np.fileName+" - 记事本")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"页面设置(U)...",shortcut:"",enabled:!0,handler:()=>print()},{title:"打印(P)...",shortcut:"Ctrl+P",enabled:!0,handler:()=>print()},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"退出(X)",shortcut:"",enabled:!0,handler:()=>console.log("退出(X) menu clicked!")}],width:"202px",left:"0px"},{title:"编辑(E)",menuItems:[{title:"撤销(U)",shortcut:"Ctrl+Z",enabled:!1,handler:function(){console.log("撤销(U) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"剪切(T)",shortcut:"Ctrl+X",enabled:!0,handler:function(){console.log("剪切(X) menu clicked!")}},{title:"复制(C)",shortcut:"Ctrl+C",enabled:!1,handler:function(){console.log("复制(C) menu clicked!")}},{title:"粘贴(P)",shortcut:"Ctrl+V",enabled:!1,handler:function(){console.log("粘贴(P) menu clicked!")}},{title:"删除(L)",shortcut:"Del",enabled:!1,handler:function(){console.log("删除(L) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"使用 Bing 搜索...",shortcut:"Ctrl+E",enabled:!0,handler:()=>$editor.bingSearch()},{title:"查找(F)...",shortcut:"Ctrl+F",enabled:!1,handler:()=>$dlgSearch.show(e=>$editor.search(e))},{title:"查找下一个(N)",shortcut:"F3",enabled:!1,handler:function(){console.log("查找下一个(N) menu clicked!")}},{title:"替换(R)...",shortcut:"Ctrl+H",enabled:!0,handler:()=>$dlgReplace.show({searchHandler:e=>$editor.search(e),replaceHandler:e=>$editor.replace(e),replaceAllHandler:e=>$editor.replaceAll(e)})},{title:"转到(G)...",shortcut:"Ctrl+G",enabled:!0,handler:()=>$dlgGoto.show({lineNum:$editor.getRow(),totalLine:$editor.getTotalLn(),gotoHandler:e=>$editor.gotoLn(e)})},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"全选(A)",shortcut:"Ctrl+A",enabled:!0,handler:()=>$editor.selectAll()},{title:"时间/日期(D)",shortcut:"F5",enabled:!0,handler:()=>$editor.insertDataTime()}],width:"218px",left:"52px"},{title:"格式(O)",menuItems:[{title:"自动换行(W)",shortcut:"",enabled:!0,handler:()=>{np.bWrap=!np.bWrap,localStorage.setItem("bWrap",np.bWrap),np.bWrap?($statusBar.display(!1),$editor.resize(!1),$menubar.enabled(3,0,!1),$menubar.enabled(1,9,!1)):($statusBar.display(np.bShowStatusBar),$editor.resize(np.bShowStatusBar),$menubar.enabled(3,0,!0),$menubar.enabled(1,9,!0),$menubar.checked(3,0,np.bShowStatusBar)),$menubar.checked(2,0,np.bWrap),$editor.setWrap(np.bWrap)}},{title:"字体(F)...",shortcut:"",enabled:!0,handler:()=>$dlgFont.show({family:np.fontFamily,style:np.fontStyle,size:np.fontSize,okHandler:np.fontHandler})}],width:"156px",left:"106px"},{title:"查看(V)",menuItems:[{title:"状态栏(S)",shortcut:"",enabled:!0,handler:()=>{np.bShowStatusBar=!("boolean"==typeof np.bShowStatusBar?np.bShowStatusBar:"true"===np.bShowStatusBar),localStorage.setItem("bShowStatusBar",np.bShowStatusBar),$statusBar.display(np.bShowStatusBar),$menubar.checked(3,0,np.bShowStatusBar),$editor.resize(np.bShowStatusBar)}}],width:"138px",left:"162px"},{title:"帮助(H)",menuItems:[{title:"查看帮助(H)",shortcut:"",enabled:!0,handler:()=>window.open("https://cn.bing.com/search?q=获取有关+windows+10+中的记事本的帮助","_blank")},{title:"关于记事本(A)",shortcut:"",enabled:!0,handler:()=>$dlgAbout.show()}],width:"166px",left:"216px"}];let $dlgAbout=new Dialog("about");(e=>{const t="https://github.com/wangding/jsnotepad/";let l=`\n    <h1 class="slogan">JSNotepad</h1>\n    <hr>\n    <img class="app-logo" src="../../images/notepad-icon-32.png" alt="JSNotepad">\n    <div class="info">\n      <p>作者：王顶</p>\n      <p>QQ：408542507</p>\n      <p>仓库地址：<a href="${t}" target="_blank">${t}</a></p>\n    </div>\n    <input class="btn-ok btn" type="button" value="确定" autofocus>`,n=e.generate(l,"关于“记事本”"),a=n.find(".btn-ok");e.show=()=>{$("body").append(n),e.init(),a.focus(),a.click(e.destory),n.click(e=>{a.focus(),e.stopPropagation()})}})($dlgAbout);let $dlgFont=new Dialog("font");(e=>{let t=e.generate('\n    <div class="font-family"><p>字体(F):</p></div>\n    <div class="font-style"><p>字形(Y):</p></div>\n    <div class="font-size"><p>大小(S):</p></div>\n    <fieldset class="sample">\n      <legend>示例</legend>\n      <p class="sample-txt">AaBbYyZz</p>\n    </fieldset>\n    <div class="script">\n      <label>\n        脚本(R):<br>\n        <select>\n          <option value="西欧语言">西欧语言</option>\n          <option value="中文 GB2312">中文 GB2312</option>\n        </select>\n      </label>\n    </div>\n    <input class="btn-ok btn" type="button" value="确定">\n    <input class="btn-cancel btn" type="button" value="取消">',"字体"),l=t.find(".btn-ok"),n=t.find(".btn-cancel"),a=t.find(".sample-txt"),s=["Agency FB","Algerian","Arial","Arial Rounded MT","Axure Handwriting","Bahnschrift","Baskerville Old Face","Bauhaus 93","Bell MT","Berlin Sans FB","Bernard MT","BlackAdder ITC"],i=["常规","斜体","粗体","粗斜体"],o=["8","9","10","11","12","14","16","18","20","22","24","26","28","36","48","72"],d={family:"Arial",style:"常规",size:"16",okHandler:null},r=()=>{a.css({"font-family":d.family,"font-size":d.size+"pt"}),np.setFontStyle(a,d.style)};e.show=a=>{$.extend(d,a),$("body").append(t),e.init(),(new comList).show({container:".notepad-dlg-font .font-family",width:"176px",list:s,select:s.indexOf(d.family),isFont:!0,selectHandler:e=>{d.family=s[e],r()}}),(new comList).show({container:".notepad-dlg-font .font-style",width:"132px",list:i,select:i.indexOf(d.style),isFontStyle:!0,selectHandler:e=>{d.style=i[e],r()}}),(new comList).show({container:".notepad-dlg-font .font-size",width:"64px",list:o,select:o.indexOf(d.size),selectHandler:e=>{d.size=o[e],r()}}),r(),n.click(e.destory),l.click(()=>{d.okHandler({family:d.family,style:d.style,size:d.size}),e.destory()}),t.click(e=>e.stopPropagation())}})($dlgFont);let $dlgGoto=new Dialog("goto");(e=>{let t=e.generate('\n    <label for="">行号(L):</label><br>\n    <input class="txt-line-num" type="text" autofocus><br>\n    <input class="btn-goto btn" type="button" value="转到">\n    <input class="btn-cancel btn" type="button" value="取消">',"转到指定行"),l=t.find(".btn-cancel"),n=t.find(".btn-goto"),a=t.find(".txt-line-num"),s=$('<div class="err-msg"></div>'),i={lineNum:1,totalLine:1,gotoHandler:null},o=()=>{c()&&(i.gotoHandler(a.val()),e.destory())},d=e=>{/[0-9]/.test(e.key)||(e.preventDefault(),r("你只能在此输入数字!"))},r=e=>{s.html(e),$(n.parent()).append(s),setTimeout(()=>{s.remove(),a.select()},3e3)},c=()=>{if(""===a.val())return r("行号不能为空！"),!1;let e=Number(a.val());return isNaN(e)?(r("行号不是数字！"),!1):0===e?(r("行号不能小于 1！"),a.select(),!1):!(e>i.totalLine)||(r("行号超过了总行数！"),!1)};e.show=s=>{$.extend(i,s),a.focus(),a.select(),$("body").append(t),e.init(),l.click(e.destory),n.click(o),a.keypress(d),t.click(e=>{a.focus(),a.select(),e.stopPropagation()}),a.val(i.lineNum),a.select()}})($dlgGoto);let $dlgReplace=new Dialog("replace",!1);(e=>{let t={searchHandler:null,replaceHandler:null,replaceAllHandler:null},l=e.generate('\n    <label>查找内容(N):<input class="txt-search" type="text" autofocus><br></label>\n    <label>替换为(P):<input class="txt-replace" type="text"><br></label>\n    <label><input type="checkbox" value="capital-sense">区分大小写(C)</label>\n    <input class="btn-search btn" type="button" value="查找下一个(F)">\n    <input class="btn-replace btn" type="button" value="替换(R)">\n    <input class="btn-replace-all btn" type="button" value="全部替换(A)">\n    <input class="btn-cancel btn" type="button" value="取消">',"替换"),n=l.find(".btn-cancel"),a=l.find(".btn-search"),s=l.find(".btn-replace"),i=l.find(".btn-replace-all"),o=l.find(".txt-search"),d=l.find(".txt-replace"),r=()=>c(""!==o.val()),c=e=>{e?(a.removeAttr("disabled"),s.removeAttr("disabled"),i.removeAttr("disabled")):(a.attr("disabled","disabled"),s.attr("disabled","disabled"),i.attr("disabled","disabled"))},p=()=>({search:o.val(),replace:d.val(),capitalSense:"capital-sense"===l.find('input[type="checkbox"]:checked').val()}),u=()=>t.searchHandler(p()),b=()=>t.replaceHandler(p()),h=()=>t.replaceAllHandler(p());e.show=p=>{$.extend(t,p),$("body").append(l),e.init(),o.val(""),d.val(""),o.focus(),l.find('input[value="capital-sense"]')[0].checked=!1,c(!1),n.click(e.destory),o.keyup(r),a.click(u),s.click(b),i.click(h),l.click(e=>{o.focus(),e.stopPropagation()})}})($dlgReplace);let $dlgSave=new Dialog("save");(e=>{let t=e.generate('\n    <p>你想将更改保存到&nbsp;<span class="file-name"></span>&nbsp;吗？</p>\n    <div class="bottom">\n      <input class="btn-save btn" type="button" value="保存(S)" autofocus>\n      <input class="btn-not-save btn" type="button" value="不保存(N)">\n      <input class="btn-cancel btn" type="button" value="取消">\n    </div>',"记事本"),l=t.find(".btn-save"),n=t.find(".btn-not-save"),a=t.find(".btn-cancel"),s=t.find(".file-name"),i={saveHandler:null,notSaveHandler:null};e.show=o=>{$.extend(i,o),s.text(np.fileName),$("body").append(t),e.init(),l.focus(),a.click(e.destory),l.click(()=>{i.saveHandler(),e.destory()}),n.click(()=>{i.notSaveHandler(),e.destory()}),t.click(e=>{l.focus(),e.stopPropagation()})}})($dlgSave);let $dlgSearch=new Dialog("search",!1);function Dialog(e,t=!0){let l=$('\n    <div class="notepad-dlg-mask">\n      <div class="dialogbox notepad-dlgbox">\n        <div class="notepad-dlg-titlebar">\n          <p class="title"></p>\n          <span class="close-btn" title="关闭">✖</span>\n        </div>\n        <div class="main notepad-dlg-main">\n        </div>\n      </div>\n    </div>'),n=l.find(".close-btn"),a=l.find(".notepad-dlg-titlebar"),s="notepad-dlg-"+e;this.destory=()=>l.remove(),this.generate=(e,n)=>{let a=l.find(".main"),i=l.find(".title");return a.html(e),i.html(n),l.addClass(s),t||l.removeClass("notepad-dlg-mask"),l},this.init=()=>{l.find(".dialogbox").draggable({handle:a}),n.click(this.destory)}}(e=>{let t=e.generate('\n    <label>查找内容(N): <input class="txt-content" type="text" autofocus></label><br>\n    <label><input type="checkbox" value="capital-sense">区分大小写(C)</label>\n    <fieldset class="search-direction">\n      <legend>方向</legend>\n      <label><input type="radio" name="direction" value="up">向上(U)</label>\n      <label><input type="radio" name="direction" value="down" checked>向下(D)</label>\n    </fieldset>\n    <input class="btn-search btn" type="button" value="查找下一个(F)" disabled>\n    <input class="btn-cancel btn" type="button" value="取消">',"查找"),l=t.find(".btn-cancel"),n=t.find(".btn-search"),a=t.find(".txt-content"),s=()=>{""!==a.val()?n.removeAttr("disabled"):n.attr("disabled","disabled")};e.show=i=>{$("body").append(t),e.init(),t.find('input[value="up"]').removeAttr("checked"),t.find('input[value="down"]')[0].checked=!0,t.find('input[type="checkbox"]').removeAttr("checked"),n.attr("disabled","disabled"),a.val(""),a.focus(),l.click(e.destory),a.keyup(s),n.click(()=>i({content:a.val(),capitalSense:"capital-sense"===t.find('input[type="checkbox"]:checked').val(),direction:t.find('input[name="direction"]:checked').val()})),a.click(e=>e.stopPropagation())}})($dlgSearch);let $editor=(()=>{let e=$('\n    <div class="notepad-editor">\n      <textarea spellcheck="false" auto-size="none"></textarea>\n    </div>'),t=e.find("textarea"),l={wrap:!1,posHandler:null,contentHandler:null},n=!1;t.keyup(()=>{l.posHandler(s(),a()),l.contentHandler(""!==t.val())}),t.keypress(()=>{let e=$("title").html();"*"!==e[0]&&$("title").text("*"+e),np.hasChanged=!0,l.posHandler(s(),a())}),t.mousedown(()=>n=!0),t.mouseup(()=>n=!1),t.mousemove(()=>{n&&l.posHandler(s(),a())}),t.click(()=>l.posHandler(s(),a()));let a=()=>{let e=t.val().substr(0,t[0].selectionStart).split("\n");return e[e.length-1].length+1},s=()=>t.val().substr(0,t[0].selectionStart).split("\n").length,i=e=>{e?(t.attr("wrap","soft"),t.css({"overflow-x":"hidden"})):(t.attr("wrap","off"),t.css({"overflow-x":"scroll"}))};return{show:n=>{$.extend(l,n),$("body").append(e),t.trigger("focus"),i(l.wrap)},resize:t=>{t?e.css({bottom:"21px"}):e.css({bottom:"0"})},focus:()=>t.focus(),getTotalLn:()=>t.val().split("\n").length,getRow:s,getCol:a,getContent:()=>t.val(),setContent:e=>t.val(e),setWrap:i,newFile:()=>t.val(""),selectAll:()=>{let e=t.val().length;t[0].selectionStart=0,t[0].selectionEnd=e,t.select()},insertDataTime:()=>{let e=t.val(),n=e.substring(0,t[0].selectionStart),i=e.substring(t[0].selectionEnd,e.length);e=n+(new Date).toLocaleString()+i,t.val(e),t.focus(),l.posHandler(s(),a())},gotoLn:e=>{let n=0,i=t.val().split("\n");for(let t=0;t<e-1;t++)n+=i[t].length+1;t[0].selectionStart=n,t[0].selectionEnd=n,t.focus(),l.posHandler(s(),a())},bingSearch:()=>{let e=t[0].selectionStart,l=t[0].selectionEnd;if(e===l)window.open("https://cn.bing.com/","_blank");else{let n=t.val().substring(e,l);window.open("https://cn.bing.com/search?q="+n,"_blank")}},search:e=>{let n=t.val(),i=e.content;e.capitalSense||(n=n.toLowerCase(),i=i.toLowerCase());let o,d=t[0].selectionEnd;if("down"===e.direction)o=n.indexOf(i,d);else{o=n.substr(0,t[0].selectionStart).lastIndexOf(i)}-1!==o?(t[0].selectionStart=o,t[0].selectionEnd=o+i.length,l.posHandler(s(),a())):alert('找不到 "'+e.content+'"')},setFont:e=>{t.css({"font-family":e.family,"font-size":e.size+"pt"}),np.setFontStyle(t,e.style)}}})();function comList(){let e,t=$('\n    <div class="notepad-com-list">\n      <input class="editor" type="text"><br>\n      <ul class="list">\n      </ul>\n    </div>'),l=t.find(".editor"),n=t.find(".list"),a={container:"",list:[],select:0,width:"200px",isFont:!1,isFontStyle:!1,selectHandler:null},s=()=>{let s=$(a.container).find(".notepad-com-list");var i;0!==s.length&&s.remove(),$(a.container).append(t),t.css({width:a.width}),(()=>{let t,l=0;if(a.isFont)for(l=0;l<a.list.length;l++)t=$('<li class="item"></li>'),t.css({"font-family":a.list[l]}),n.append(t.html(a.list[l]));else if(a.isFontStyle)for(l=0;l<a.list.length;l++)t=$('<li class="item"></li>'),np.setFontStyle(t,a.list[l]),n.append(t.html(a.list[l]));else for(l=0;l<a.list.length;l++)t=$('<li class="item"></li>'),n.append(t.html(a.list[l]));e=n.find(".item")})(),i=a.select,$(e[i]).addClass("selected"),l.val(a.list[i]),l.select(),e[i].scrollIntoView({behavior:"smooth",block:"start"})};this.show=t=>{$.extend(a,t),s(),n.click(t=>{$(e[a.select]).removeClass("selected"),a.select=a.list.indexOf($(t.target).html()),$(e[a.select]).addClass("selected"),l.val(a.list[a.select]),l.select(),a.selectHandler(a.select)}),l.keyup(()=>{let t=0;for(t=0;t<a.list.length&&0!==a.list[t].indexOf(l.val());t++);t!==a.list.length&&(e[t].scrollIntoView({behavior:"smooth",block:"start"}),$(e[a.select]).removeClass("selected"),$(e[t]).addClass("selected"),a.select=t)})}}let $menubar=(()=>{let e,t=$('<div class="notepad-menubar"></div>'),l=[],n=-1;return{show:a=>{e=a,(()=>{let a=$('<ul class="menu-title"></ul>');for(let t=0;t<e.length;t++){let s=$('<li class="title"></li>');s.html(e[t].title),s.attr("data-id",t),a.append(s),s.click(e=>{let t=Number(e.target.dataset.id);-1===n?(l[t].css({display:"inline-block"}),n=t):n!==t?(l[n].css({display:"none"}),l[t].css({display:"inline-block"}),n=t):(l[n].css({display:"none"}),n=-1),e.stopPropagation()}),s.hover(e=>{if(-1!==n){let t=Number(e.target.dataset.id);l[n].css({display:"none"}),l[t].css({display:"inline-block"}),n=t}})}t.append(a)})(),(()=>{for(let a=0;a<e.length;a++){let s=$('<ul class="menus"></ul>'),i=e[a].menuItems;for(let t=0;t<i.length;t++){if("hr"===i[t].title){let e=$('<li class="menu-hr"></li>');s.append(e);continue}let o=$('<li class="menu-item"></li>');if(o.html(i[t].title),o.attr("data-x",a),o.attr("data-y",t),""!==i[t].shortcut){let e=$('<span class="shortcut"></span>');e.html(i[t].shortcut),o.append(e)}i[t].enabled||o.addClass("disabled"),s.append(o),o.click(t=>{if(t.stopPropagation(),$(t.target).hasClass("disabled"))return;let a=t.target.dataset.x,s=t.target.dataset.y;l[a].css({display:"none"}),n=-1,e[a].menuItems[s].handler()})}s.css({width:e[a].width,left:e[a].left,display:"none"}),t.append(s),l.push(s)}})(),$("body").append(t)},checked:(e,t,n)=>{let a=l[e].find(".menu-item")[t];n?$(a).prepend($('<span class="checked">✓</span>')[0]):$(a).find(".checked").remove()},enabled:(e,t,n)=>{let a=l[e].find(".menu-item")[t];n?$(a).removeClass("disabled"):$(a).addClass("disabled")},hideMenu:()=>{-1!==n&&(l[n].css({display:"none"}),n=-1)}}})(),$statusBar=(()=>{let e=$('\n    <div class="notepad-statusbar">\n      <div class="left-panel"></div>\n      <div class="right-panel">\n        <p class="row-col"></p>\n      </div>\n    </div>'),t=e.find(".row-col"),l={row:1,col:1},n=(e,l)=>t.html("第&nbsp;x&nbsp;行，第&nbsp;y&nbsp;列".replace("x",e).replace("y",l));return{init:t=>{$.extend(l,t),n(l.row,l.col),$("body").append(e)},setRowCol:n,display:t=>e.css("display",t?"block":"none")}})();